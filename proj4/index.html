<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: left;
      font-weight: 300;
      font-family: 'Open Sans', sans-serif;
      color: #121212;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: 'Source Sans Pro', sans-serif;
    }
  </style>
  <title>CS 284 Cloth Sim</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>


<body>

  <h1 align="middle">CS 284: Computer Graphics and Imaging, Spring 2022</h1>
  <h1 align="middle">Project 4: Assignment 5: Cloth Simulation</h1>
  <h2 align="middle">Ce Hao, CS284</h2>

  <br><br>

  <div>
    <p> The website of this write up is: <a href="https://cal-cs184-student.github.io/sp22-project-webpages-CeHao1/proj4/index.html"> online write up </a></p>

    <h2 align="middle">Overview</h2>
    <p>In this project, we will finish the dynamic and shader simulation of cloth, including the movement and contact collision. 
      The dynamic simulations are in part 1 to 4, and the part 5 has more subtopics to finish.
    </p>

    <!-- ================================================================ part 1============================================== -->
    <h2 align="middle">Part 1: Masses and springs</h2>


    <p>In the first part, we complete some tasks.</p>
    <ol>
      <li>
        In the range of num_width_points and num_height_points, create the horizontal and vertical position for the mass point. 
        Set the position and the last point position to (0,0) and (width, height). Save the points to point_masses.
      </li>
      <li>
        Set the pinned variable to be true forsome special pinned points, if the point index is in the vector.
      </li>
      <li>
        Add the springs according to the structual, sheear and blending constraints, so that we can change these three constraints in the GUI.
      </li>
    </ol>


    <div align="middle">
      <table width="100%" align="middle">
          <tr>
              <td align="middle">
                  <img src="images/p1_origin.png" width="80%"/>
                  <figcaption align="middle">Spring mesh</figcaption>
              </td>
              <td align="middle">
                  <img src="images/p1_ori2.png" width="80%"/>
                  <figcaption align="middle">Spring mesh</figcaption>
              </td>
          </tr>
      </table>
  </div>

    <p>
      The overview render result is shown in the above figure. We can find the horizontal spring mesh with structual and shear girds.
    </p>

    <div align="middle">
      <table width="100%" align="middle">
          <tr>
              <td align="middle">
                  <img src="images/p1_all_const.png" width="80%"/>
                  <figcaption align="middle">All constraints</figcaption>
              </td>
              <td align="middle">
                  <img src="images/p1_no_shear.png" width="80%"/>
                  <figcaption align="middle">No shear constraint</figcaption>
              </td>
              <td align="middle">
                <img src="images/p1_only_shear.png" width="80%"/>
                <figcaption align="middle">Only shear constraint</figcaption>
            </td>
          </tr>
      </table>
  </div>

  <p>
    Here we change the constraints using the buttons, but the images in the website show some moire. Zoom in can make these images sharper.
    With all constraints, the mesh has all structual, shear and bending grids, but the structual and bending springs are overlaping, so we can 
    only see the structual. 
  </p>
  <p>
    When we remove the shear, and only the grids parallel to the x and y axises exist. And when we only leave the shear constraint, we can only
    see the diagonal springs.
  </p>

    <!-- ================================================================ part 2============================================== -->
    <h2 align="middle">Part 2: Simulation via numerical integration</h2>

      <p> In this part, we need to finish the physical movement simulation of the spring by calculation the acceleration and 
        integrate the velocity and position. Here are three steps to follow.
      </p>

      <ol>
        <li>
          First of all, we need to cauculate the total force(acceleration) on each point mass. The spring forces are generated by the 
          relative length of each sping, and the external forces(gravity) are exerted globally to the points. Here we have the spring stiffness parameter
          ks that control the value of spring forces.
        </li>
        <li>
          Then, we will use the verlet integration to update the new position of the points. In addition, we add a damping parameter d to 
          simulate the energy damping, so that the postion could finally converge.
        </li>
        <li>
          Finally, we use a trick that the strached length is no greater than 10% of the rest length, to eliminate the unreasonable doeformation.
          If the relative distance of two points is larger than 10%, we will reduce the relative distance equally to both points if they are not pinned.
        </li>
      </ol>

    
      <p>
        In the following of this section, we implement three groups of experiments in which we change the value of spring sitffness ks, 
        the density(gravity) forces, and the damping effective in the integration. 
        The default values are ks = 5 kN/m, density = 15 g/cm^2, damping = 0.2.
      </p>

      <h4>1. Changing spring stiffness ks</h4>


      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_ks_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> ks = 1 kN/m</figcaption>
            </td>
            <td>
              <img src="images/p2_ks_10.png" align="middle" width="200px"/>
              <figcaption align="middle"> ks = 10 kN/m </figcaption>
            </td>
            <td>
            <img src="images/p2_ks_50.png" align="middle" width="200px"/>
            <figcaption align="middle"> ks = 50 kN/m </figcaption>
            </td>
            <td>
            <img src="images/p2_ks_100.png" align="middle" width="200px"/>
            <figcaption align="middle"> ks = 100 kN/m </figcaption>
            </td>
          </tr>
        </table>
      </div>

      <p>
        When we increase the stiffness of the spring ks, the dangling region between two pinned points is less stretched because 
        the spring is very tough and hard to be streched to longer length. Finally, the mesh grid converges to the equilibirum that 
        the spring internal forces can exactly neutralize external acceleration on each point mass.
      </p>

      <h4>2. Changing density</h4>


      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_d_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> density = 1 g/cm^2 </figcaption>
            </td>
            <td>
              <img src="images/p2_d_5.png" align="middle" width="200px"/>
              <figcaption align="middle"> density = 5 g/cm^2 </figcaption>
            </td>
            <td>
            <img src="images/p2_d_10.png" align="middle" width="200px"/>
            <figcaption align="middle"> density = 10 g/cm^2 </figcaption>
            </td>
            <td>
            <img src="images/p2_d_20.png" align="middle" width="200px"/>
            <figcaption align="middle"> density = 20 g/cm^2 </figcaption>
            </td>
          </tr>
        </table>
      </div>

      <p>
        If we increase the density, the gravity will go up. So this is a conter-situation of increasing spring stiffness. 
        When the gravity is larger, the spring is streched longer so the dangling region bends more. 
      </p>
      <p>
        However, if we keep increasing the gravity, even much larger than the spring forces, the mesh will not be extremely long because 
        we added a constraint to the maximum length of each spring. This might not be physically reasonable, but it is helpful to make 
        the rendered results goodlooking for human.
      </p>

      <h4>3. Changing damping</h4>
      <p> We screenshot the images at time = 1, 2, 3, 4 seconds, with different damping rate.</p>
      

      <!-- <p>(1) damping = 0</p> -->

      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_dp_0_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0, t=1s </figcaption>
            </td>
            <td>
              <img src="images/p2_dp_0_2.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0, t=2s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_0_3.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0, t=3s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_0_4.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0, t=4s </figcaption>
            </td>
          </tr>
        </table>
      </div>

      <!-- <p>(2) damping = 0.2</p> -->
      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_dp_2_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.2, t=1s </figcaption>
            </td>
            <td>
              <img src="images/p2_dp_2_2.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.2, t=2s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_2_3.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.2, t=3s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_2_4.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.2, t=4s </figcaption>
            </td>
          </tr>
        </table>
      </div>

      <!-- <p>(3) damping = 0.4</p> -->

      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_dp_4_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.4, t=1s </figcaption>
            </td>
            <td>
              <img src="images/p2_dp_4_2.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.4, t=2s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_4_3.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.4, t=3s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_4_4.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.4, t=4s </figcaption>
            </td>
          </tr>
        </table>
      </div>

      <!-- <p>(4) damping = 0.6</p> -->

      <div align="middle">
        <table style="width=100%">
          <tr>
            <td>
              <img src="images/p2_dp_6_1.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.6, t=1s </figcaption>
            </td>
            <td>
              <img src="images/p2_dp_6_2.png" align="middle" width="200px"/>
              <figcaption align="middle"> damp=0.6, t=2s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_6_3.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.6, t=3s </figcaption>
            </td>
            <td>
            <img src="images/p2_dp_6_4.png" align="middle" width="200px"/>
            <figcaption align="middle"> damp=0.6, t=4s </figcaption>
            </td>
          </tr>
        </table>
      </div>

    

      <p>
        When we increase the damping rate, the mesh falls slower, and the overshot disappears. Basically, we can regard it as a second-order 
        control system with different damping rate, as non-damping, under-damping, critical damping and over-damping. 
      </p>

      <p>
        If the damping rate is too small, the mesh keeps bouncing at the time and never stops. But when we add too much damping, the cloth seems like
        floating in the atmosphere. In the physcial simulation, choose a small under-damping about 0.4 is more realistic.
      </p>

      <div align="middle">
        <img src="images/p2_pin4.png" align="middle" width="40%" />
              <figcaption align="middle">Pinned 4</figcaption>
    </div>

    <p>
      Finally, we show a screenshot of pinned 4. The innner dangling region falls down, and there are 4 major directions from the pinned points
       to the center point of the mesh, where the springs are more rigid than other places.
    </p>

    <!-- ================================================================ part 3============================================== -->
    <h2 align="middle">Part 3: Handling collisions with other objects</h2>

    <p>
      In this part, we will deal with the collision of the cloth with a solid object such as a sphere or a plane.
    </p>

    <ol>
      <li>
        In the first sphere collision task, we need to check whether a point is inside the sphere. We calculate the distance from the point
         to center of the sphere and compare with the radius. Then we can calculate the direction vector and adjust the new position to the 
         tangent point also scaled by a friction rate.
      </li>
      <li>
        Similarly, we need to check whether the point is on the above side of the plane using the dot product of the normal vector and point mass direction.
        If the point is below the plane, we find the tangent point and add a small SURFACE_OFFSET to the position. The new position is 
        also updated using the last postion and tangent point, scaled by the friction.
      </li>
      <li>
        We also need to change the cloth simulation function, to iterate all mass points and obstacles(collision objects). In this case,
        we only have one sphere and one plane, but there might be more objects so we still need to consider all objects.
      </li>
    </ol>

    <div align="middle">
      <table style="width=100%">
        <tr>
          <td>
            <img src="images/p3_t1_05k.png" align="middle" width="300px"/>
            <figcaption align="middle"> ks = 500 </figcaption>
          </td>
          <td>
            <img src="images/p3_t1_5k.png" align="middle" width="300px"/>
            <figcaption align="middle"> ks = 5,000 </figcaption>
          </td>
          <td>
          <img src="images/p3_t1_50k.png" align="middle" width="300px"/>
          <figcaption align="middle"> ks = 50,000 </figcaption>
          </td>
        </tr>
      </table>
    </div>

    <p>
      The first experiment is for the sphere, when we change the spring stiffness ks = 500, 5k and 50k. We find similar results with 
      the part 2. If ks is larger, the cloth is less dangling because the spring is tougher against the gravity. If we use a small ks,
      the cloth seems more soft and gets more attached to the sphere.
    </p>



  <div align="middle">
    <table width="100%" align="middle">
        <tr>
            <td align="middle">
                <img src="images/p3_t2.png" width="80%"/>
                <figcaption align="middle">Pinned 4 with Bling-Phong shader</figcaption>
            </td>
            <td align="middle">
                <img src="images/p3_t2_2.png" width="80%"/>
                <figcaption align="middle">Pinned 4 with texture</figcaption>
            </td>
        </tr>
    </table>
</div>

  <p> In the second plane experiment, the cloth just evenly falls down on the plane and lays peacefully on the plane.
    After finishing part 5, we added the shader on it.
  </p>
  

    <!-- ================================================================ part 4============================================== -->
    <h2 align="middle">Part 4: Handling self-collisions</h2>

    <p>
      In this new part, we will implement the self-colliion function. When the cloth contact itself, two points should not overlap because the 
      cloth has physicall thickness. So will check the relative position of two points in the self-collide function and call it in the simulate.
      In addition, we would like to accelerate the n^2 checking process, we save the position of points in a hash map to find the nearest point.
    </p>

    <p> The details are as follows.</p>

    <ol>
      <li>
        At the beginning of self-collision check, we construct a hash map at first. After cleaning the map, we iterate all point, and 
        if the near region has no other point(by calling the hash_position), we add this new point to the map.
      </li>
      <li>
        Then we focus on the the look up method hash_position. Actaully, we cut the whole space into w*h*t small boxes. When we input a 
        postion of a new point, the map will return the exact point that filling in this small box. This box might be empty, but 
        if the self point exists, we will use it to bounce back these two points in the self_collide function.
      </li>
      <li>
        The last and the most function is the self_collide. This function is very similar to the sphere and plane collision, but happens between two points.
        We iterate all points and search in the hash map to find another point that takes the place of the same small box. Maybe there are 
        more than one point in the same box, so we also iterate all candiates. If the relative distance is smaller than the twice thickness, 
        we use the correction vector to update the position, and finally average the position using the number of real colliding points. 
        In addition, we also use the simulation_steps to scale the correction.
      </li>
      <li>
        We finally call the self_collide function in the simulate before the collision check with other objects.
      </li>
    </ol>


    <div align="middle">
      <table style="width=100%">
        <tr>
          <td>
            <img src="images/p4_1_1.png" align="middle" width="300px"/>
            <figcaption align="middle"> early stage</figcaption>
          </td>
          <td>
            <img src="images/p4_1_2.png" align="middle" width="300px"/>
            <figcaption align="middle"> keep falling</figcaption>
          </td>
        </tr>
        <br>
        <tr>
          <td>
            <img src="images/p4_1_3.png" align="middle" width="300px"/>
            <figcaption align="middle"> initial self-collision</figcaption>
          </td>
          <td>
            <img src="images/p4_1_4.png" align="middle" width="300px"/>
            <figcaption align="middle"> ending (converged)</figcaption>
          </td>
        </tr>
      </table>
    </div>

    <p> Here we show four stages of the falling experiments. </p>
    <ol>
      <li>
        At the very early stage, the cloth is bumped and the cloth on the ground is not clipping itself anymore.
      </li>
      <li>
        As the cloth keeps falling, we can clearly see that the cloth is folded with itself and it has a certain thickness.
      </li>
      <li>
        At the initial self-collision stage, the cloth is still bouncing itself and it has almost 5 layers so it is still in a very unstable condition.
      </li>
      <li>
        After about 10 seconds, the cloth gradually expends itself to cover a larger area on the plane and be flatten. At this moment, 
        the cloth is peaceful and the spring system has converged to a steady state.
      </li>
    </ol>


    <h4> (1) Changing density</h4>
    <div align="middle">
      <table style="width=100%">
        <tr>
          <td>
            <img src="images/p4_2_de_1.png" align="middle" width="200px"/>
            <figcaption align="middle"> density = 1 </figcaption>
          </td>
          <td>
            <img src="images/p4_2_de_5.png" align="middle" width="200px"/>
            <figcaption align="middle"> density = 5 </figcaption>
          </td>
          <td>
          <img src="images/p4_2_de_10.png" align="middle" width="200px"/>
          <figcaption align="middle"> density = 10 </figcaption>
          </td>
          <td>
          <img src="images/p4_2_de_20.png" align="middle" width="200px"/>
          <figcaption align="middle"> density = 20 </figcaption>
          </td>
        </tr>
      </table>
    </div>

    <h4> (2) Chaning spring ks</h4>

    <div align="middle">
      <table style="width=100%">
        <tr>
          <td>
            <img src="images/p4_2_ks_1.png" align="middle" width="200px"/>
            <figcaption align="middle"> ks = 1k </figcaption>
          </td>
          <td>
            <img src="images/p4_2_ks_10.png" align="middle" width="200px"/>
            <figcaption align="middle"> ks = 10k </figcaption>
          </td>
          <td>
          <img src="images/p4_2_ks_50.png" align="middle" width="200px"/>
          <figcaption align="middle"> ks = 50k </figcaption>
          </td>
          <td>
          <img src="images/p4_2_ks_100.png" align="middle" width="200px"/>
          <figcaption align="middle"> ks = 100k </figcaption>
          </td>
        </tr>
      </table>
    </div>

    <p>
      The most evident difference is the conditon of wrinkle(folds) of the cloth when it intitially totally self-collide with itself.
      If we increase the density or reduce the ks, the number of wrinkle will increase. This is because the gravity is relatively 
      larger with respect to the spring force. So the cloth is directly pressed down to the plane with many folds. But if the spring is 
      very stiff, it is very hard to bend the cloth since it will bounce back to the planner condition (think about a steel spring).
    </p>

    <p>
      However, if we wait really long time, even if the density is large, it is still likely to find that wrinkle reduces. 
      It seems that the cloth with the self-collision we implemented is very slippery, even without much friction. So the cloth will slide
      on itself and more parts finally fall on the ground.
    </p>

    <!-- ================================================================ part 5============================================== -->
    <h2 align="middle">Part 5: Shaders</h2>
     
    <p>
      In this new and special section, we will write the .frag and .vert files to change the position of vertics and the texture on the point surface.
    </p>

    <p>
      From the overview, the .vert and .frag have different functions. Just like what we did in the project 2 and 3, .vert file works on 
      the position of vertices(mesh operations in project 2), and the .frag works on the ray tracing and pixel values(BSDF in project 3).
      At the beginning of the program, the .frag files will define the BSDF or the texture mapped to the surface.
      Then the program will try to find the matching .vert file telling how to set up the vertices using the pre-vertex values. 
    </p>

    <p>
      In short, .vert changes the shape of the object; .frag changes the surface texture(BSDF) of the object. We can use different combination to 
      create colorful redenrings.
    </p>
    
    <h3 align="middle">Task 1: Diffuse Shading + Task 2: Blinn-Phong Shading</h3>

    <p> In the first two tasks, we will implement the Bling-Phong shading, which has three shading components: the ambient, diffuse and specular component.
      The total reflection is the combination of these three components.
    </p>

    <ol>
      <li>
        For the ambient component, the object will reflect a global illumination, so all pixels are added with a same value.
      </li>
      <li>
        For the diffuse component, the surface reflects light to the hemisphere and decay propotional to the inverse distance square.
        In addition, the irradiance is governed by the Lambertain cos law.  
      </li>
      <li>
        The last component is the specular reflection. In addition to the angle between wi and normal direction, we need to consider the 
        bisector direction of inside and outside rays.
      </li>
      
    </ol>

    <div align="middle">
      <table style="width=100%">
        <tr>
          <td>
            <img src="images/p5_t12_amb.png" align="middle" width="300px"/>
            <figcaption align="middle"> Ambient</figcaption>
          </td>
          <td>
            <img src="images/p5_t12_dif.png" align="middle" width="300px"/>
            <figcaption align="middle"> Diffuse</figcaption>
          </td>
        </tr>
        <br>
        <tr>
          <td>
            <img src="images/p5_t12_spc.png" align="middle" width="300px"/>
            <figcaption align="middle"> Specular</figcaption>
          </td>
          <td>
            <img src="images/p5_t12_pho.png" align="middle" width="300px"/>
            <figcaption align="middle"> Blinn-Phong </figcaption>
          </td>
        </tr>
      </table>
    </div>

    <p>
      Here we show the single shading components and the entire Blinn-Phong shading. We can find that the ambient shading is uniform everywhere.
      The diffuse shading shows brightness at the uncovered area. And the the specular shading only reflects at the front place 
      with certain normal and observation directions.
    </p>
    <p>
      In all, the three components create a vivid reflection on a cloth.
    </p>

    <h3 align="middle">Task 3: Texture Mapping</h3>

    <p> In this section, we use the texture function to map a png image to the cloth.</p>

    <div align="middle">
      <table width="100%" align="middle">
          <tr>
              <td align="middle">
                  <img src="images/p5_t3_col.png" width="80%"/>
                  <figcaption align="middle">texture mapping on self-collision</figcaption>
              </td>
              <td align="middle">
                  <img src="images/p5_t3_sph.png" width="80%"/>
                  <figcaption align="middle">texture mapping on sphere collision</figcaption>
              </td>
          </tr>
      </table>
  </div>

  <p> I changed the texture images in the texture folder and show the texture mapping using two cartoon images.</p>

  <h3 align="middle">Task 4.1: Bump Mapping</h3>

  <p> In this segement, we use the tangent-bitangent-normal (TBN) matrix to change the height on the cloth and sphere surface. </p>

  <div align="middle">
    <table width="100%" align="middle">
        <tr>
            <td align="middle">
                <img src="images/p5_t41_cloth.png" width="80%"/>
                <figcaption align="middle">bump, sphere covered by cloth</figcaption>
            </td>
            <td align="middle">
                <img src="images/p5_t41_sph.png" width="80%"/>
                <figcaption align="middle">bump, the sphere</figcaption>
            </td>
        </tr>
    </table>
</div>

<p> I use the texture_3 of wall bricks and set the height more than 1. The above two images are the bumped cloth and the sphere.</p>

<h3 align="middle">Task 4.2: Displacement Mapping</h3>

<p> In the displacement.vert, we change the in position with the equation p' = p + n * h * kh. This change will change the 
  vertices position.
</p>

<div align="middle">
  <table width="100%" align="middle">
      <tr>
          <td align="middle">
              <img src="images/p5_t42_cloth.png" width="80%"/>
              <figcaption align="middle">displacement, sphere covered by cloth</figcaption>
          </td>
          <td align="middle">
              <img src="images/p5_t42_sph.png" width="80%"/>
              <figcaption align="middle">displacement, the sphere</figcaption>
          </td>
      </tr>
  </table>
</div>

<p> We also use the wall bricks texture, but this time I only set height = 0.1. Otherwise, the displacement is too large.</p>

<p>
  By comparing the Bump in fragment and displacement(bump fragmen + displacement vertex), we can find the similarity that 
  in both images, the sphere and cloth have the brick texture. But in fact, the bump fragment on the sphere is just flat, since 
  we do not change the actual position of vertices. In the displacement implementation, we also change the vertex position based on the
  texture values. 
</p>

<p>
  According to their character, we can set a very large height to the bump since the only difference is on the surface pixels. But 
  once we set a large height to the displacement, the whole sphere will be totally covered by the displacement.
</p>


<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/p5_43_bump_16.png" align="middle" width="300px"/>
        <figcaption align="middle"> bump a,o = 16</figcaption>
      </td>
      <td>
        <img src="images/p5_43_bump_128.png" align="middle" width="300px"/>
        <figcaption align="middle"> bump a,o = 128</figcaption>
      </td>
    </tr>
    <br>
    <tr>
      <td>
        <img src="images/p5_43_disp_16.png" align="middle" width="300px"/>
        <figcaption align="middle"> displacement a,o = 16</figcaption>
      </td>
      <td>
        <img src="images/p5_43_disp_128.png" align="middle" width="300px"/>
        <figcaption align="middle"> displacement a,o = 128</figcaption>
      </td>
    </tr>
  </table>
</div>

<p>
  In the figure, if the mesh of the sphere is more coarse as a,o =16, 
  the displacement performs much worse since the vertices are undersampling the texture. 
  There aren't enough vertices to sample the jump in height in the texture. 
  For the bump render though, the difference is much smaller. 
  This is due to the fact that our texture is mostly uniform except for the jumps between the bricks, 
  and rendering can correctly interpolate the color between the vertices. 
  If our texture is more refined and has more discontinuities, the difference between the two mesh will be more prominent.
</p>

<h3 align="middle">Task 5: Environment-mapped Reflections</h3>

<p>
  In the last task, we focus on the mirror reflection. We need to project the image to a environmental map, and then 
  sample radiance from the environment. The process is similar to the one-bounce reflection. We calculate the out ray by the pixel point 
  and the camera, and then derive the wi based on the normal, finally backtracing to the environment map.
</p>

<div align="middle">
  <table width="100%" align="middle">
      <tr>
          <td align="middle">
              <img src="images/p5_5_sph.png" width="80%"/>
              <figcaption align="middle">Environment map, sphere</figcaption>
          </td>
          <td align="middle">
              <img src="images/p5_5_cloth.png" width="80%"/>
              <figcaption align="middle">Environment map, cloth</figcaption>
          </td>
      </tr>
  </table>
</div>

<p>
  Finally, we find that sphere is reflecting the image from the environment. It seems like a mimir material. 
  In addition, the cloth is also mirror-like. It is very fascinating to see a soft cloth reflecting like a mirror.
</p>

</body>

</html>